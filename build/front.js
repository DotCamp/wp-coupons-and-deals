(()=>{class t{constructor(t){this.wrapper=t,this.expirationDateWrapper=this.wrapper.querySelector(".ub-coupon-expiration-date"),this.copyButton=this.wrapper.querySelector(".ub-coupon-button:not(.ub-popup-button)"),this.showCodeButton=this.wrapper.querySelector(".ub-coupon-button.ub-popup-button"),this.expirationDate=new Date(this.wrapper.dataset.expiration_date).getTime(),this.expiredDateText=this.wrapper.dataset.expired_date_text,this.couponCode=this.wrapper.dataset.coupon_code,this.init()}init(){this.checkExpirationDate(),this.setupCopyButton(),this.handleHiddenCoupon();const t=new URL(location),e=t?.searchParams?.get("ub_coupon");this.wrapper.classList.contains("ub-coupon-hidden")&&this.showCodeButton&&!e&&this.handleShowCode()}handleShowCode(){this.showCodeButton.addEventListener("click",(()=>{const t=this.wrapper.getAttribute("data-coupon_id"),e=new URL(location);e.searchParams.set("ub_coupon",t),window.open(e,"_blank")}))}handleHiddenCoupon(){if(!this.wrapper.classList.contains("ub-coupon-hidden"))return;const t=new URL(location),e=t?.searchParams?.get("ub_coupon");if(!e||"null"===e)return;const o=document.getElementById(e),n=this.wrapper.querySelector(".ub-coupon-button.ub-popup-button");n.removeAttribute("href"),n.classList.add("ub-coupon-popup-opened"),o.style.display="block",o.querySelector(".ub-coupon-popup-close-button").addEventListener("click",(()=>{o.style.display="none"}))}checkExpirationDate(){Date.now()>this.expirationDate&&(this.expirationDateWrapper.textContent=this.expiredDateText,this.expirationDateWrapper.classList.add("ub-coupon-expired"))}setupCopyButton(){const t=this.copyButton.innerText;this.copyButton.addEventListener("click",(()=>{this.copyButton.innerText="Copied!",this.copyToClipboard(),setTimeout((()=>{this.copyButton.innerText=t}),1e3)}))}async copyToClipboard(){const t=document.createElement("input");t.value=this.couponCode,t.type="text",document.body.appendChild(t),t.select(),document.execCommand("Copy"),document.body.removeChild(t)}}window.addEventListener("DOMContentLoaded",(()=>{document.querySelectorAll(".ub-coupon-wrapper:not(.ub-coupon-type-deal)").forEach((e=>{new t(e)}))}))})();